{
  "if": {
    "allOf": [
      {
        "anyOf": [
          {
            "field": "type",
            "equals": "Microsoft.OpenAI/*"
          },
          {
            "field": "type",
            "equals": "Microsoft.Fabric/*"
          },
          {
            "field": "type",
            "equals": "Microsoft.Compute/virtualMachines/*"
          }
        ]
      },
      {
        "anyOf": [
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.OpenAI/*"
              },
              {
                "not": {
                  "field": "Microsoft.OpenAI/modelType",
                  "in": ["fineTuning"]
                }
              },
              {
                "not": {
                  "field": "Microsoft.OpenAI/allowedDeployments",
                  "greater": 1
                }
              }
            ]
          },
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Fabric/*"
              },
              {
                "field": "Microsoft.Fabric/version",
                "equals": "Trial"
              },
              {
                "not": {
                  "field": "Microsoft.Fabric/allowedDeployments",
                  "greater": 1
                }
              }
            ]
          },
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Compute/virtualMachines"
              },
              {
                "field": "Microsoft.Compute/virtualMachines/sku.name",
                      "equals": [
                        "Standard_D4s_v3",
                        "Standard_D3_v2",
                        "Standard_DS3_v2",
                        "Standard_DS1_v2",
                        "Standard_D2s_v3",
                        "Standard_D2as_v4",
                        "Standard_B2s",
                        "Standard_B1s",
                        "Standard_B2ms",
                        "Standard_B1ls",
                        "Standard_B4ms",
                        "Standard_D4s_v3"
                      ]
                    },
                    {
                      "not": {
                        "field": "Microsoft.Compute/virtualMachines/allowedDeployments",
                        "greater": 1
                      }
                    }
                  ]
                 }
        ]
      },
      {
        "anyOf": [
          // ADLS Gen2
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Storage/storageAccounts"
              },
              {
                "field": "Microsoft.Storage/accountType",
                "equals": "BlobStorage"
              },
              {
                "field": "Microsoft.Storage/sku",
                "equals": "Standard_LRS"
              },
              {
                "not": {
                  "field": "Microsoft.Storage/allowedDeployments",
                  "equals": 2
                }
              }
            ]
          },
          // Azure SQL
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Sql/servers"
              },
              {
                "field": "Microsoft.Sql/edition",
                "equals": "Basic"
              },
              {
                "not": {
                  "field": "Microsoft.Sql/allowedDeployments",
                  "equals": 1
                }
              }
            ]
          },
          // ADF
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.DataFactory/factories"
              },
              {
                "field": "Microsoft.DataFactory/sku",
                "equals": "Standard"
              },
              {
                "not": {
                  "field": "Microsoft.DataFactory/allowedDeployments",
                  "equals": 1
                }
              }
            ]
          },
          // Azure ML
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.MachineLearningServices/workspaces"
              },
              {
                "field": "Microsoft.MachineLearningServices/sku",
                "equals": "Basic"
              },
              {
                "not": {
                  "field": "Microsoft.MachineLearningServices/allowedDeployments",
                  "equals": 1
                }
              }
            ]
          },
          // Azure Functions
          {
            "allOf": [
              {
                "field": "type",
                "equals": "Microsoft.Web/sites"
              },
              {
                "field": "Microsoft.Web/sku",
                "equals": "Consumption"
              },
              {
                "not": {
                  "field": "Microsoft.Web/allowedDeployments",
                  "equals": 1
                }
              }
            ]
          }
          ]
      }
    ]
  },
  "then": {
    "effect": "allow"
  }
}
